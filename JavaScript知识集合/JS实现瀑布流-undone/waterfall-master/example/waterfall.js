!function(){"use strict";!function(){let t=!1;function e(){this.sub={}}function n(t={}){e.call(this),this.opts={number:t.number,fixWidth:t.fixWidth||null,width:`${t.width||document.body.clientWidth||document.documentElement.clientWidth}px`,container:t.container||"waterfall",resize:!1,scrollElem:t.scrollElem},this.init(t),this.bind()}e.prototype.on=function(t,e){this.sub[t]||(this.sub[t]||(this.sub[t]=[]),this.sub[t].push(e))},e.prototype.emit=function(t){const e=Array.prototype.slice.call(arguments,1);for(let n=0,o=this.sub[t].length;n<o;n++)this.sub[t][n].apply(this,e)},n.prototype=Object.create(e.prototype),n.prototype.constructor=n;const o=n.prototype;o.compareOpts=function(t){const e=this;Object.keys(t).forEach(n=>{e.opts[n]=t[n]})},o.init=function(t){this.compareOpts(t);const e=document.getElementById(this.opts.container);e.style.width=`${this.opts.fixWidth||this.opts.width}px`;const n=e.getElementsByTagName("img");this.opts.resize&&this.resize(n);const o=this.getPerNum(),i=[];for(let t=0;t<o;t++)i.push(n[t].offsetHeight);let s=this.getMinPointer(i)||"0";if(this.opts.fixWidth)for(let t=0;t<o;t++)n[t].style.position="absolute",n[t].style.left=`${n[0].offsetLeft+n[t].offsetWidth*t}px`;for(let t=o;t<n.length;t++)n[t].style.position="absolute",n[t].style.left=`${n[s].offsetLeft}px`,n[t].style.top=`${i[s]}px`,i[s]=i[s]+n[t].offsetHeight,s=this.getMinPointer(i)},o.getPerNum=function(){const t=document.getElementById(this.opts.container).getElementsByTagName("img")[0].offsetWidth;return Math.floor(parseInt(this.opts.fixWidth||this.opts.width,10)/t)},o.append=function(){const t=document.getElementById(this.opts.container).getElementsByTagName("img"),e=t.length,n=this.getPerNum(),o=[],i=e-this.opts.number;let s=1;const l={},c=[];for(;s<100&&(l[t[i-s].offsetLeft]||0===l[t[i-s].offsetLeft]||(l[t[i-s].offsetLeft]=t[i-s].offsetLeft,o.push(t[i-s].offsetHeight+t[i-s].offsetTop),c.push(s),c.length!==n));)s++;let h=this.getMinPointer(o)||0;for(let e=0;e<this.opts.number;e++)t[i+e].style.position="absolute",t[i+e].style.left=`${t[i-c[Number(h)]].offsetLeft}px`,t[i+e].style.top=`${o[h]}px`,o[h]=o[h]+t[i+e].offsetHeight,h=this.getMinPointer(o)},o.bind=function(){this.opts.fixWidth||l.addEventListener(window,"resize",i.bind(this));const t=document.getElementById(this.opts.scrollElem);l.addEventListener(t||window,"scroll",s.bind(this))},o.unbind=function(){const t=document.getElementById(this.opts.scrollElem);l.removeEventListener(t||window,"scroll",s.bind(this))},o.getMinPointer=function(t){const e=Math.min.apply(null,t);for(let n in t)if(t[n]===e)return n},o.resize=function(t){for(let e=0;e<t.length;e++)t[e].style.position="static";this.opts.resize=!1},o.done=function(){const e=this;this.on("done",function(){t=!1,document.getElementsByClassName("waterfall-loading")[0].setAttribute("class",""),e.append()}),this.emit("done")},o.loadImg=function(){const t=document.getElementById(this.opts.container),e=document.createElement("div");e.setAttribute("class","waterfall-loading"),t.appendChild(e)};const i=function(){this.init({resize:!0,width:`${document.body.clientWidth||document.documentElement.clientWidth}px`})},s=function(){if(this.opts.scrollElem){if(t)return!1;const e=document.getElementById(this.opts.container);if(!e)return!1;const n=e.getElementsByTagName("img"),o=document.getElementById(this.opts.scrollElem);o.scrollTop+o.clientHeight>n[n.length-1].offsetTop&&(t=!0,this.loadImg(),this.emit("load"))}else{if(t)return!1;const e=document.getElementById(this.opts.container).getElementsByTagName("img");(document.body.scrollTop||document.documentElement.scrollTop)+(document.body.clientHeight||document.documentElement.clientHeight)>e[e.length-1].offsetTop&&(t=!0,this.loadImg(),this.emit("load"))}},l={addEventListener:function(t,e,n){t.addEventListener(e,n,!1)},removeEventListener:function(t,e,n){t.removeEventListener(e,n,!1)}};window.Waterfall=n}()}();
